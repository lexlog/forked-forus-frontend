top-navbar
section.section.section-product: .wrapper

    .block.block-breadcrumbs
        a(ui-sref="home").breadcrumb-item Home
        a(ui-sref="products").breadcrumb-item Aanbod
        .breadcrumb-item.active(ng-bind="$ctrl.product.name")

    .block.block-product
        .product-card
            .product-photo(ng-style="{'background-image':'url({{ $ctrl.product.photo.sizes.large || './assets/img/placeholders/product-large.png' }})'}")
                img(ng-src="{{ $ctrl.product.photo.sizes.large || './assets/img/placeholders/product-large.png' }}")
            
            .product-details
                .product-name
                    span(ng-bind="$ctrl.product.name")
                    span.label.label-success(ng-if="!$ctrl.product.deleted && !$ctrl.product.sold_out" i18n="product.status.active")
                    span.label.label-danger(ng-if="!$ctrl.product.deleted && $ctrl.product.sold_out" i18n="product.status.out_of_stock")
                .organization-name(ng-bind="$ctrl.product.organization.name")

                .product-details-horizontal
                    .product-categories
                        .category-label(i18n="product.labels.category")
                        .category-value(ng-bind="$ctrl.product.product_category.name")
                    .product-expire(ng-if="$ctrl.product.expire_at")
                        .expire-label(i18n="product.labels.expire")
                        .expire-value {{ "product.labels.expire_prefix" | translate }} {{ $ctrl.product.expire_at_locale }}
                hr
                .block-content
                    .block-header(i18n="product.labels.description")
                    .block.block-markdown
                        div(ng-bind-html="$ctrl.product.description_html")

        .block.block-info-card(ng-if="$ctrl.product.funds.length > 0")
            .block-header(i18n="product.headers.funds")  
            .block-products-content
                .product-funds-list
                    .fund-item(ng-repeat="fund in $ctrl.product.funds")
                        .fund-item-info
                            .fund-item-media
                                .fund-item-media-value: img.fund-item-media-img(ng-src="{{ fund.logo.sizes.thumbnail || '/assets/img/placeholders/fund-thumbnail.png' }}")
                            .fund-item-name
                                .fund-item-name-value(ng-bind="fund.name")
                        .fund-item-limit(ng-if="fund.type == 'subsidies'")
                            .fund-item-limit-label(i18n="product.labels.limit")
                            .fund-item-limit-value(ng-bind="fund.limit_available")
                        .fund-item-apply(
                            translate="product.buttons.{{ $root.client_key }}.request"
                            translate-default="{{ 'product.buttons.request' | translate }}"
                            ng-click="$ctrl.requestFund(fund)"
                            ng-if="fund.type == 'subsidies' ? !fund.meta.isApplicableSubsidy : !fund.meta.isApplicable")
                        .fund-item-price(ng-if="!$ctrl.product.no_price && (fund.type == 'subsidies' ? fund.meta.isApplicableSubsidy : fund.meta.isApplicable)")
                            .fund-item-price-value(
                                ng-bind="fund.price == 0 ? 'Gratis' : ((fund.type == 'subsidies' ? fund.price : $ctrl.product.price) | currency_format)")
                        .fund-item-apply(
                            i18n="product.buttons.buy"
                            ng-if="!fund.meta.isApplicableSubsidy && !$ctrl.product.no_price && $ctrl.useBudget && fund.meta.isApplicable && !$ctrl.product.deleted && !$ctrl.product.sold_out"
                            ng-click="$ctrl.applyProduct()")

        .block.block-pane.last-child(ng-click="$ctrl.goToProvider($event, $ctrl.product.organization)")
            .pane-head(i18n="product.headers.organization")  
            .organization-pane
                .office-organization(ng-click="$ctrl.toggleOffices($event, $ctrl.product.organization)")
                    .organization-photo(ng-click="$ctrl.goToProvider($event, $ctrl.product.organization)")
                        img(ng-src="{{ $ctrl.product.organization.logo.sizes.thumbnail || '/assets/img/placeholders/organization-thumbnail.png'  }}").organization-photo-img
                    .organization-title
                        .organization-title-value(ng-click="$ctrl.goToProvider($event, $ctrl.product.organization)" ng-bind="$ctrl.product.organization.name")
                        .organization-title-count(ng-click="$ctrl.goToProvider($event, $ctrl.product.organization)" ng-bind="$ctrl.product.offices.length")
                    .organization-chevron: .mdi(ng-class="'mdi-chevron-' + ($ctrl.product.organization.showOffices ? 'up' : 'right')")           
      
        .block.block-organizations(ng-if="$ctrl.product.organization.showOffices"): .organization-item
                .organization-offices: .block.block-offices
                    a(ng-repeat="office in $ctrl.product.offices" ng-click="$ctrl.goToOffice(office)").office-item
                        .office-item-map-icon: .mdi.mdi-map-marker
                        .office-pane
                            .office-pane-block
                                .office-logo: img(
                                    ng-src="{{ office.organization.logo.sizes.thumbnail || '/assets/img/placeholders/office-thumbnail.png' }}"
                                    ).office-logo-img
                                .office-details
                                    .office-title(ng-bind="office.address")
                                    .office-labels
                                        .label.label-default(ng-bind="$ctrl.product.organization.business_type.name || 'Geen organisatie type'")
                                    
                                    div(ng-if="office.phone || provider.phone || provider.email")
                                        .office-info.office-info-inline(ng-if="office.phone || provider.phone")
                                            .mdi.mdi-phone-outline
                                            | {{ office.phone ? office.phone : provider.phone }}
                                        
                                        .office-info.office-info-inline(ng-if="provider.email")
                                            .mdi.mdi-email-outline
                                            | {{ provider.email }}

        .block.block-map_card
            .map_card-header
                .map_card-title(i18n="product.headers.map")

            .map_card-iframe: google-map(
                map-gesture-handling="'greedy'"
                map-pointer-template="providers-office"  
                map-pointers="$ctrl.product.offices")